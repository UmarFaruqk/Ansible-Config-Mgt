pipeline:
  agent: any
  stages:
    - stage: "Initial cleanup"
      steps:
        - dir: "${WORKSPACE}"
          steps:
            - deleteDir: {}
    - stage: "Checkout SCM"
      steps:
        - git:
            branch: "main"
            url: "https://github.com/UmarFaruqk/php-todo"
    - stage: "Prepare Dependencies"
      steps:
        - sh: "echo pass"
          # Uncomment the lines below if needed
          # - sh: "mv .env.sample .env"
          # - sh: "composer install"
          # - sh: "php artisan migrate"
          # - sh: "php artisan db:seed"
          # - sh: "php artisan key:generate"
    - stage: "Execute Unit Tests"
      steps:
        - sh: "./vendor/bin/phpunit"
      stages:
        - stage: "Code Analysis"
          steps:
            - sh: "phploc app/ --log-csv build/logs/phploc.csv"
        - stage: "Plot Code Coverage Report"
          steps:
            - script:
                plot:
                  - csvFileName: "plot-396c4a6b-b573-41e5-85d8-73613b2ffffb.csv"
                    csvSeries:
                      - displayTableFlag: false
                        exclusionValues: "Lines of Code (LOC),Comment Lines of Code (CLOC),Non-Comment Lines of Code (NCLOC),Logical Lines of Code (LLOC)"
                        file: "build/logs/phploc.csv"
                        inclusionFlag: "INCLUDE_BY_STRING"
                        url: ""
                    group: "phploc"
                    numBuilds: "100"
                    style: "line"
                    title: "A - Lines of Code"
                    yaxis: "Lines of Code"
                  - csvFileName: "plot-396c4a6b-b573-41e5-85d8-73613b2ffffb.csv"
                    csvSeries:
                      - displayTableFlag: false
                        exclusionValues: "Directories,Files,Namespaces"
                        file: "build/logs/phploc.csv"
                        inclusionFlag: "INCLUDE_BY_STRING"
                        url: ""
                    group: "phploc"
                    numBuilds: "100"
                    style: "line"
                    title: "B - Structures Containers"
                    yaxis: "Count"
                  - csvFileName: "plot-396c4a6b-b573-41e5-85d8-73613b2ffffb.csv"
                    csvSeries:
                      - displayTableFlag: false
                        exclusionValues: "Average Class Length (LLOC),Average Method Length (LLOC),Average Function Length (LLOC)"
                        file: "build/logs/phploc.csv"
                        inclusionFlag: "INCLUDE_BY_STRING"
                        url: ""
                    group: "phploc"
                    numBuilds: "100"
                    style: "line"
                    title: "C - Average Length"
                    yaxis: "Average Lines of Code"
                  - csvFileName: "plot-396c4a6b-b573-41e5-85d8-73613b2ffffb.csv"
                    csvSeries:
                      - displayTableFlag: false
                        exclusionValues: "Cyclomatic Complexity / Lines of Code,Cyclomatic Complexity / Number of Methods"
                        file: "build/logs/phploc.csv"
                        inclusionFlag: "INCLUDE_BY_STRING"
                        url: ""
                    group: "phploc"
                    numBuilds: "100"
                    style: "line"
                    title: "D - Relative Cyclomatic Complexity"
                    yaxis: "Cyclomatic Complexity by Structure"
                  - csvFileName: "plot-396c4a6b-b573-41e5-85d8-73613b2ffffb.csv"
                    csvSeries:
                      - displayTableFlag: false
                        exclusionValues: "Classes,Abstract Classes,Concrete Classes"
                        file: "build/logs/phploc.csv"
                        inclusionFlag: "INCLUDE_BY_STRING"
                        url: ""
                    group: "phploc"
                    numBuilds: "100"
                    style: "line"
                    title: "E - Types of Classes"
                    yaxis: "Count"
                  - csvFileName: "plot-396c4a6b-b573-41e5-85d8-73613b2ffffb.csv"
                    csvSeries:
                      - displayTableFlag: false
                        exclusionValues: "Methods,Non-Static Methods,Static Methods,Public Methods,Non-Public Methods"
                        file: "build/logs/phploc.csv"
                        inclusionFlag: "INCLUDE_BY_STRING"
                        url: ""
                    group: "phploc"
                    numBuilds: "100"
                    style: "line"
                    title: "F - Types of Methods"
                    yaxis: "Count"
                  - csvFileName: "plot-396c4a6b-b573-41e5-85d8-73613b2ffffb.csv"
                    csvSeries:
                      - displayTableFlag: false
                        exclusionValues: "Constants,Global Constants,Class Constants"
                        file: "build/logs/phploc.csv"
                        inclusionFlag: "INCLUDE_BY_STRING"
                        url: ""
                    group: "phploc"
                    numBuilds: "100"
                    style: "line"
                    title: "G - Types of Constants"
                    yaxis: "Count"
                  - csvFileName: "plot-396c4a6b-b573-41e5-85d8-73613b2ffffb.csv"
                    csvSeries:
                      - displayTableFlag: false
                        exclusionValues: "Test Classes,Test Methods"
                        file: "build/logs/phploc.csv"
                        inclusionFlag: "INCLUDE_BY_STRING"
                        url: ""
                    group: "phploc"
                    numBuilds: "100"
                    style: "line"
                    title: "I - Testing"
                    yaxis: "Count"

